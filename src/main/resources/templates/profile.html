<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Profile - DALI</title>
    <!-- CSS and other head elements -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles specific to profile page for better layout */
        .profile-page { padding: 40px 0; }
        .profile-header {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .profile-header h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
        }
        .profile-header p {
            color: #666;
            margin-bottom: 15px;
        }
        .profile-actions {
            display: flex;
            gap: 15px;
        }
        .profile-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 30px;
            align-items: flex-start;
        }
        .profile-sidebar, .profile-main {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .profile-sidebar h3 {
            margin-bottom: 20px;
        }
        .profile-sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .profile-sidebar li a {
            display: block;
            padding: 10px 0;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            border-bottom: 1px solid #eee;
        }
        .profile-sidebar li:last-child a {
            border-bottom: none;
        }
        .profile-sidebar li a:hover {
            color: #b21984;
        }
        .profile-main h2 {
            margin-bottom: 25px;
        }
        .address-card, .order-card {
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .no-orders-found { text-align: center; color: #666; padding: 40px 0; }
    </style>
</head>
<body>

<header th:replace="~{fragments/header :: header}"></header>

<main class="container profile-page">
    <div class="profile-header" th:object="${account}">
        <h1 th:text="*{getFullName()}">John Doe</h1>
        <p th:text="*{email}">john.doe@example.com</p>
        <div class="profile-actions">
            <a th:href="@{/profile/change-password}" class="btn btn-secondary btn-small">Change Password</a>
        </div>
    </div>

    <!-- General Success/Error Messages -->
    <div th:if="${successMessage}" class="auth-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="auth-error" th:text="${errorMessage}"></div>
    <div th:if="${param.error == 'access_denied'}" class="auth-error">You do not have permission to view that order.</div>


    <div class="profile-content">
        <aside class="profile-sidebar">
            <h3>My Account</h3>
            <ul>
                <li><a href="#orders">My Orders</a></li>
                <li><a href="#addresses">My Addresses</a></li>
            </ul>
        </aside>

        <div class="profile-main">
            <section id="orders">
                <h2>My Orders</h2>
                <div th:if="${!hasOrders}" class="no-orders-found">
                    You have not placed any orders yet.
                </div>
                <div th:if="${hasOrders}" class="admin-order-grid" style="grid-template-columns: 1fr;">
                    <div th:each="order : ${orders}" class="admin-order-card">
                        <div class="order-card-icon">
                            <img th:src="@{/images/order-icon.png}" alt="Order Icon">
                        </div>
                        <div class="order-card-details">
                            <h3 th:text="'Order #' + ${order.orderId}">Order #12345</h3>
                            <p class="order-card-meta">
                                <span th:text="${#temporals.format(order.createdAt, 'dd MMM yyyy')}"></span> •
                                <span th:text="${order.getTotalItemCount()} + ' items'"></span> •
                                <span th:text="${order.paymentMethod}"></span>
                            </p>
                            <p class="order-card-price" th:text="'₱' + ${#numbers.formatDecimal(order.totalPrice, 1, 'COMMA', 2, 'POINT')}">₱2,350.50</p>
                        </div>
                        <div class="order-card-footer">
                            <div class="order-card-status">
                                <span class="status-dot" th:classappend="${order.shippingStatus.cssClass}"></span>
                                <span th:text="${order.shippingStatus.description}"></span>
                            </div>
                            <div class="order-card-actions">
                                <a th:href="@{'/order/' + ${order.orderId}}" class="btn btn-secondary btn-small">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="addresses" style="margin-top: 40px;">
                <h2>My Addresses</h2>
                <!-- Address management would go here. For now it is part of the checkout flow. -->
                <div th:if="${account.addresses.isEmpty()}" class="no-address-notice">
                    You have no saved addresses. You can add one during checkout.
                </div>
                <div th:each="addr : ${account.addresses}" class="address-card">
                    <strong th:text="${account.getFullName()}"></strong>
                    <span th:if="${addr.isDefault()}" class="tag-default" style="margin-left:10px;">Default</span>
                    <p th:text="${addr.getFullAddress()}" style="margin-top: 5px;"></p>
                    <p th:text="${addr.phoneNumber}"></p>
                </div>
            </section>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>